<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>Echo SDK v3 tests</title>
	<style>
		body { margin: 0px; padding: 0px; }
		#container { padding: 10px; width: 80%; background: #FFFFFF; border: 1px solid #FFFFFF; box-shadow: 0 4px 15px #666666; margin: 10px auto 0px auto; }
		#echo-tests { background: #FFFFFF; }
		#qunit-header, #qunit-tests > li:last-child { border-radius:0; }
	</style>
	<link href="{%=baseURLs.sdk%}/gui.pack.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="{%=baseURLs.sdk%}/loader.js"></script>
	<script type="text/javascript">
		
		var harnessDependencies = [
			"jquery", "echo/api",
			"echo/app", "echo/events",
			"echo/streamserver/user", "echo/utils",
			"QUnit", "echo/backplane"
		];

		var harnessServiceFiles =[
			"config", "helpers/events.js",
			"fixtures/api/count.js", "fixtures/api/search.js",
			"fixtures/api/whoami.js"
		];

		var startTests = function() {
			Echo.Tests.init({
				"title": "echo sdk v3 tests",
				"backplane": {
					"serverBaseURL": "https:{%=baseURLs.api.backplane%}/v1",
					"busName": "jskit"
				}
			});
		}

		Echo.require(harnessDependencies, function($, API, App, Events, User, Utils, QUnit) {
			Echo.Utils = Utils;
			Echo.App = App;
			Echo.Plugin = Plugin;
			Echo.Events = Events;
			Echo.jQuery = $;
			Echo.API = API;
			Echo.StreamServer.User = User;
			//harness loading
			Echo.require([
				"echo/tests/harness", 
				"echo/tests/harness/suite"
			], function() {
				Echo.Tests.Fixtures = {
					"api": {},
					"loader": {},
					"canvases": {}
				};
				Echo.Tests.Units = []; //wrapped units array
				//packs loading	
				Echo.require(["unit/unit.pack"], function() {
					var initializeTests = function() {
						Utils.sequentialCall(Echo.Tests.Units, startTests);
					};
					//tests initializing
					Echo.require(harnessServiceFiles, initializeTests);
				});
			});
		});
	</script>
</head>
<body>
	<div id="container">
		<div id="echo-tests">
			<h1 id="qunit-header"></h1>
			<h2 id="qunit-banner"></h2>
			<div id="qunit-testrunner-toolbar"></div>
			<h2 id="qunit-userAgent"></h2>
			<ol id="qunit-tests"></ol>
			<div id="qunit-fixture"></div>
		</div>
	</div>
</body>
</html>
