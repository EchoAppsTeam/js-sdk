<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">(function(jQuery) {
&quot;use strict&quot;;

var $ = jQuery;

<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery'>/**
</span> * @class Echo.StreamServer.Controls.Stream.Item.MediaGallery 
 * The MediaGallery control is used to display different media (pictures, video,
 * flash objects, etc). 
 *
 * @extends Echo.Control
 *
 * @package streamserver/plugins/pinboard-visualization.js
 */

var mediaGallery = Echo.Control.manifest(&quot;Echo.StreamServer.Controls.Stream.Item.MediaGallery&quot;);

if (Echo.Control.isDefined(mediaGallery)) return;

<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-method-getRelativeTime'>/** @hide @method getRelativeTime */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-today'>/** @hide @echo_label today */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-yesterday'>/** @hide @echo_label yesterday */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-lastWeek'>/** @hide @echo_label lastWeek */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-lastMonth'>/** @hide @echo_label lastMonth */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-secondAgo'>/** @hide @echo_label secondAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-secondsAgo'>/** @hide @echo_label secondsAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-minuteAgo'>/** @hide @echo_label minuteAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-minutesAgo'>/** @hide @echo_label minutesAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-hourAgo'>/** @hide @echo_label hourAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-hoursAgo'>/** @hide @echo_label hoursAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-dayAgo'>/** @hide @echo_label dayAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-daysAgo'>/** @hide @echo_label daysAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-weekAgo'>/** @hide @echo_label weekAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-weeksAgo'>/** @hide @echo_label weeksAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-monthAgo'>/** @hide @echo_label monthAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-monthsAgo'>/** @hide @echo_label monthsAgo */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-loading'>/** @hide @echo_label loading */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-retrying'>/** @hide @echo_label retrying */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_busy'>/** @hide @echo_label error_busy */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_timeout'>/** @hide @echo_label error_timeout */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_waiting'>/** @hide @echo_label error_waiting */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_view_limit'>/** @hide @echo_label error_view_limit */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_view_update_capacity_exceeded'>/** @hide @echo_label error_view_update_capacity_exceeded */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_result_too_large'>/** @hide @echo_label error_result_too_large */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_wrong_query'>/** @hide @echo_label error_wrong_query */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_incorrect_appkey'>/** @hide @echo_label error_incorrect_appkey */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_internal_error'>/** @hide @echo_label error_internal_error */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_quota_exceeded'>/** @hide @echo_label error_quota_exceeded */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_incorrect_user_id'>/** @hide @echo_label error_incorrect_user_id */
</span><span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_label-error_unknown'>/** @hide @echo_label error_unknown */
</span>
mediaGallery.labels = {
	&quot;mediaIsNotAvailable&quot;: &quot;&lt;i&gt;Media is not avaiable at this moment...&lt;/i&gt;&quot;
};

<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-cfg-resizeDuration'>/**
</span> * @cfg {Number} resizeDuration
 * Duration of the resize animation media content
 *
 * @cfg {Array} elements
 * List of the jQuery elements which will be displayed (media content)
 *
 * @cfg {Object} item
 * An instance of the Echo.StreamServer.Controls.Stream.Item object
 * which may use its state for some reasons (context, data, etc)
 */
mediaGallery.config = {
	&quot;resizeDuration&quot;: 250,
	&quot;elements&quot;: [],
	&quot;item&quot;: undefined
};

mediaGallery.templates.main =
	'&lt;div class=&quot;{class:container}&quot;&gt;' +
		'&lt;div class=&quot;{class:thumbnails}&quot;&gt;' +
			'&lt;div class=&quot;{class:items}&quot;&gt;&lt;/div&gt;' +
		'&lt;/div&gt;' +
		'&lt;div class=&quot;{class:controls}&quot;&gt;&lt;/div&gt;' +
	'&lt;/div&gt;';

mediaGallery.templates.mediaError =
	'&lt;span class=&quot;{class:itemErrorLoading}&quot;&gt;{label:mediaIsNotAvailable}&lt;/span&gt;';

<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_renderer-controls'>/**
</span> * @echo_renderer
 */
mediaGallery.renderers.controls = function(element) {
	var self = this;
	var item = this.config.get(&quot;item&quot;);
	this.elements = this.config.get(&quot;elements&quot;);
	this.currentIndex = 0;
	var publish = function(topic) {
		self.events.publish({
			&quot;topic&quot;: topic,
			&quot;context&quot;: item ? item.config.get(&quot;context&quot;) : self.config.get(&quot;context&quot;)
		});
	};
	var controlsContainer = element;
	var itemsContainer = this.view.get(&quot;items&quot;);
	var itemClass = this.cssPrefix + &quot;item&quot;;
	var controlClass = this.cssPrefix + &quot;control&quot;;
	var activeControlClass = this.cssPrefix + 'activeControl';
	$.each(this.elements, function(i, element) {
		element = $(element);
		self._normalizeFlashContent(element);
		var ratio;
		var isCurrentControl = (i === self.currentIndex);
		var itemContainer = $('&lt;div&gt;&lt;/div&gt;').append(element).addClass(itemClass);
		var showCurrentMedia = function() {
<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_event-onLoadMedia'>			/**
</span>			 * @echo_event Echo.StreamServer.Controls.Stream.Item.MediaGallery.onLoadMedia
			 * Triggered when corresponding media is loaded.
			 */
			i === self.currentIndex &amp;&amp; itemContainer.css(&quot;display&quot;, &quot;block&quot;) &amp;&amp; publish(&quot;onLoadMedia&quot;);
		};
		var controlContainer = $('&lt;a href=&quot;#&quot;&gt;&lt;/a&gt;').addClass(controlClass);
		controlContainer.click(function() {
			var control = $(this);
			var currentItem = itemsContainer.children().eq(self.currentIndex);
			$(&quot;.&quot; + controlClass, controlsContainer).removeClass(activeControlClass);
			control.addClass(activeControlClass);
			itemsContainer.animate({
				&quot;height&quot;: itemContainer.height()
			}, self.config.get(&quot;resizeDuration&quot;), function() {
<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_event-onResize'>				/**
</span>				 * @echo_event Echo.StreamServer.Controls.Stream.Item.MediaGallery.onResize
				 * Triggered when corresponding media is resized.
				 */
				publish(&quot;onResize&quot;);
			});
			currentItem.fadeOut(function() {
				itemContainer.fadeIn(function() {
					self.currentIndex = i;
<span id='Echo-StreamServer-Controls-Stream-Item-MediaGallery-echo_event-onChangeMedia'>					/**
</span>					 * @echo_event Echo.StreamServer.Controls.Stream.Item.MediaGallery.onChangeMedia
					 * Triggered when media is changed.
					 */
					publish(&quot;onChangeMedia&quot;);
				});
			});
			return false;
		});
		if (isCurrentControl) {
			controlContainer.addClass(activeControlClass);
		}
		element.one(&quot;error&quot;, function() {
			itemContainer.empty().append(self.substitute({&quot;template&quot;: self.templates.mediaError}));
			showCurrentMedia();
		}).one(&quot;load&quot;, function() {
			self._loadMediaHandler(element, itemContainer);
			showCurrentMedia();
		});
		itemsContainer.append(itemContainer);
		controlsContainer.append(controlContainer);
	});
	if (this.elements.length === 1) {
		controlsContainer.hide();
	}
	return element;
};

// To avoid bugs with flash content when we show/hide it
// we should try fix it with wmode parameter if needed
mediaGallery.methods._normalizeFlashContent = function(element) {
	var tagName = element.get(0).tagName.toLowerCase();
	if (tagName === &quot;iframe&quot;) {
		var parts = Echo.Utils.parseURL(element.attr(&quot;src&quot;) || &quot;&quot;);
		if (!/(www\.)?youtube\.com/.test(parts.domain)) return;
		var query = parts.query;
		query = query &amp;&amp; ~query.indexOf(&quot;wmode&quot;)
			? query.replace(/(wmode=)([^&amp;?]+)/g, function($0, $1, $2) {
				if ($2 != &quot;opaque&quot; || $2 != &quot;transparent&quot;) {
					return $1 + &quot;opaque&quot;;
				}
			})
			: (query ? (query += &quot;&amp;wmode=opaque&quot;) : &quot;wmode=opaque&quot;);
		parts.path = parts.path || &quot;&quot;;
		parts.fragment = parts.fragment ? &quot;#&quot; + parts.fragment : &quot;&quot;;
		parts.query = query ? &quot;?&quot; + query : &quot;&quot;;
		element.attr(&quot;src&quot;, this.substitute({
			&quot;template&quot;: &quot;{data:scheme}://{data:domain}{data:path}{data:query}{data:fragment}&quot;,
			&quot;data&quot;: parts
		}));
	} else if (tagName === &quot;embed&quot;) {
		var wmode = element.attr(&quot;wmode&quot;);
		if (wmode != &quot;opaque&quot; || wmode != &quot;transparent&quot;) {
			element.attr(&quot;wmode&quot;, &quot;opaque&quot;);
		}
	}
};

mediaGallery.methods._getHiddenElementDimensions = function(parent, element) {
	var dimensions;
	parent.css({
		&quot;postion&quot;: &quot;absolute&quot;,
		&quot;visibility&quot;: &quot;hidden&quot;,
		&quot;display&quot;: &quot;block&quot;
	});
	dimensions = {
		&quot;width&quot;: element.width(),
		&quot;height&quot;: element.height()
	};
	parent.css({
		&quot;postion&quot;: &quot;&quot;,
		&quot;visibility&quot;: &quot;&quot;,
		&quot;display&quot;: &quot;&quot;
	});
	return dimensions;
};

mediaGallery.methods._loadMediaHandler = function(element, elementContainer) {
	var self = this;
	var target = this.config.get(&quot;target&quot;);
	var viewportDimensions = {
		&quot;width&quot;: target.width(),
		&quot;height&quot;: target.width()
	};
	var getElementDimensions = function() {
		return !elementContainer.is(&quot;:visible&quot;)
			? self._getHiddenElementDimensions(elementContainer, element)
			: {
				&quot;width&quot;: element.width(),
				&quot;height&quot;: element.height()
			};
	};
	var ratio;
	var elementDimensions = getElementDimensions();
	if (elementDimensions.width &gt; viewportDimensions.width) {
		ratio = viewportDimensions.width / elementDimensions.width;
		element.css({
			&quot;width&quot;: viewportDimensions.width,
			&quot;height&quot;: elementDimensions.height * ratio
		});
		elementDimensions = getElementDimensions();
	}
	if (elementDimensions.height &gt; viewportDimensions.height) {
		ratio = viewportDimensions.height / elementDimensions.height;
		element.css({
			&quot;width&quot;: elementDimensions.width * ratio,
			&quot;height&quot;: viewportDimensions.height
		});
	}
};

mediaGallery.css =
	'.{class:thumbnails} { overflow: hidden; }' +
	'.{class:item} { width: 100%; display: none; }' +
	'.{class:controls} { text-align: center; margin-top: 10px; }' +
	'.{class:control} { display: inline-block; width: 8px; height: 8px; font-size: 0px; line-height: 8px; outline: none; border-radius: 4px; vertical-align: middle; margin-left: 8px; cursor: pointer; background-color: #c6c6c6; text-decoration: none; transition: all .2s ease-in 0; -moz-transition-property: all; -moz-transition-duration: .2s; -moz-transition-timing-function: ease-in; -moz-transition-delay: 0; -webkit-transition-property: all; -webkit-transition-duration: .2s; -webkit-transition-timing-function: ease-in; -webkit-transition-delay: 0; }' +
	'.{class:control}:hover { background-color: #ee7b11; }' +
	'.{class:activeControl}, .{class:activeControl}:hover { background-color: #524d4d; }';

Echo.Control.create(mediaGallery);
	
})(Echo.jQuery);

(function(jQuery) {
&quot;use strict&quot;;

var $ = jQuery;

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization'>/**
</span> * @class Echo.StreamServer.Controls.Stream.Item.Plugins.PinboardVisualization
 * The PinboardVisualization plugin transforms Stream.Item control into a
 * pinboard-style block.
 *
 * 	new Echo.StreamServer.Controls.Stream({
 * 		&quot;target&quot;: document.getElementById(&quot;echo-stream&quot;),
 * 		&quot;query&quot;: &quot;childrenof:http://example.com/js-sdk&quot;,
 * 		&quot;appkey&quot;: &quot;echo.jssdk.demo.aboutecho.com&quot;,
 * 		&quot;plugins&quot;: [{
 * 			&quot;name&quot;: &quot;PinboardVisualization&quot;,
 * 			&quot;columnWidth&quot;: 100,
 * 			&quot;gallery&quot;: {&quot;resizeDuration&quot;: 550}
 * 		}]
 * 	});
 *
 * More information regarding the plugins installation can be found
 * in the [“How to initialize Echo components”](#!/guide/how_to_initialize_components-section-2) guide.
 *
 * @extends Echo.Plugin
 *
 * @private
 * @package streamserver/plugins/pinboard-visualization.js
 */

var plugin = Echo.Plugin.manifest(&quot;PinboardVisualization&quot;, &quot;Echo.StreamServer.Controls.Stream.Item&quot;);

if (Echo.Plugin.isDefined(plugin)) return;

plugin.init = function() {
	var self = this, item = this.component;
	this.extendTemplate(&quot;replace&quot;, &quot;container&quot;, plugin.template);
};

plugin.dependencies = [{
	&quot;loaded&quot;: function() { return !!Echo.jQuery().isotope; },
	&quot;url&quot;: &quot;{config:cdnBaseURL.sdk}/third-party/jquery/jquery.isotope.min.js&quot;
}];

plugin.config = {
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-cfg-columnWidth'>	/**
</span>	 * @cfg {Number} columnWidth
	 * Allows to define the width for one column in pixels, default width is 250px.
	 * The amount of columns is calculated based on the width of the Echo Stream
	 * Client container.
	 */
	&quot;columnWidth&quot;: 250,
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-cfg-maxChildrenBodyCharacters'>	/**
</span>	 * @cfg {Number} maxChildrenBodyCharacters
	 * Allows to truncate the reply text displayed under the root item. Default
	 * value is 50 characters. The value of this parameter should be integer and
	 * represent the number of visible characters that need to be displayed.
	 */
	&quot;maxChildrenBodyCharacters&quot;: 50,
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-cfg-mediaSelector'>	/**
</span>	 * @cfg {Function} mediaSelector
	 * Allows to define the function with custom rules for the media content
	 * extraction from the item content. The value of this parameter is a function
	 * which accepts the item content (string) as the first argument and should
	 * return the jQuery element with the list of the DOM elements which are
	 * considered to be the media content of this item.
	 * 
	 * Example (also used as a default value):
	 *
	 * 	&quot;mediaSelector&quot;: function(content) {
	 * 		var dom = $(&quot;&lt;div&gt;&quot; + content + &quot;&lt;/div&gt;&quot;);
	 * 		return $(&quot;img, video, embed, iframe&quot;, dom);
	 * 	}
	 */
	&quot;mediaSelector&quot;: function(content) {
		var dom = $(&quot;&lt;div&gt;&quot; + content + &quot;&lt;/div&gt;&quot;);
		return $(&quot;img, video, embed, iframe&quot;, dom);
	},
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-cfg-itemCSSClassByContentLength'>	/**
</span>	 * @cfg {Object} itemCSSClassByContentLength
	 * Allows to define extra CSS class to the item based on the item length.
	 * The value of this parameter is the JS object with the CSS classes as
	 * the keys and the item text length ranges as values. Multiple CSS classes
	 * might be applied to the item if the item text length meets several
	 * criteria simultaneously.
	 */
	&quot;itemCSSClassByContentLength&quot;: {
		&quot;echo-streamserver-controls-stream-item-smallSizeContent&quot;: [0, 69],
		&quot;echo-streamserver-controls-stream-item-mediumSizeContent&quot;: [70, 120]
	},
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-cfg-gallery'>	/**
</span>	 * @cfg {Object} gallery
	 * Allows to proxy the parameters for the mini Media Gallery class,
	 * initialized for the item in case any media content was found in its body. 
	 */
	&quot;gallery&quot;: {
		&quot;resizeDuration&quot;: 250
	}
};

plugin.enabled = function() {
	return document.compatMode !== &quot;BackCompat&quot;
};

plugin.labels = {
<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_label-childrenMoreItems'>	/**
</span>	 * @echo_label
	 */
	&quot;childrenMoreItems&quot;: &quot;View more items...&quot;
};

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-content'>/**
</span> * @echo_renderer
 */
plugin.component.renderers.content = function(element) {
	var plugin = this, item = this.component;
	return item.parentRenderer('content', arguments).css({
		&quot;width&quot;: parseInt(plugin.config.get(&quot;columnWidth&quot;))
	});
};

(function() {

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_event-onChangeView'>/**
</span> * @echo_event Echo.StreamServer.Controls.Stream.Item.Plugins.PinboardVisualization.onChangeView
 * Triggered if the view was changed.
 */
var publish = function(force) {
	this.events.publish({
		&quot;topic&quot;: &quot;onChangeView&quot;,
		&quot;data&quot;: {
			&quot;force&quot;: force
		}
	});
};

var getRenderer = function(name) {
	return function(element) {
		var plugin = this, item = this.component;
		element = item.parentRenderer(name, arguments);
		if (plugin.get(&quot;rendered&quot;)) {
			element.queue(&quot;fx&quot;, function(next) {
				next();
				publish.call(plugin, true);
			});
			publish.call(plugin, name === &quot;expandChildren&quot;);
		}
		return element;
	};
};

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-container'>/**
</span> * @echo_renderer
 */
plugin.component.renderers.container = getRenderer(&quot;container&quot;);

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-expandChildren'>/**
</span> * @echo_renderer
 */
plugin.component.renderers.expandChildren = getRenderer(&quot;expandChildren&quot;);

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-textToggleTruncated'>/**
</span> * @echo_renderer
 */
plugin.component.renderers.textToggleTruncated = function(element) {
	var plugin = this, item = this.component;
	return item.parentRenderer(&quot;textToggleTruncated&quot;, arguments).one('click', function() {
		publish.call(plugin, true);
	});
};

$.map([&quot;Echo.StreamServer.Controls.Stream.Item.onRerender&quot;,
	&quot;Echo.StreamServer.Controls.Stream.Item.onDelete&quot;,
	&quot;Echo.StreamServer.Controls.Stream.Item.MediaGallery.onResize&quot;,
	&quot;Echo.StreamServer.Controls.Stream.Item.MediaGallery.onLoadMedia&quot;], function(topic) {
		plugin.events[topic] = function() {
			var force = topic !== &quot;Echo.StreamServer.Controls.Stream.Item.onDelete&quot;;
			publish.call(this, force);
		};
});

$.map([&quot;Echo.StreamServer.Controls.Submit.onRender&quot;,
	&quot;Echo.StreamServer.Controls.Submit.Plugins.Edit.onEditError&quot;,
	&quot;Echo.StreamServer.Controls.Submit.Plugins.Edit.onEditComplete&quot;,
	&quot;Echo.StreamServer.Controls.Stream.Item.Plugins.Reply.onCollapse&quot;], function(event) {
	plugin.events[event] = function(topic, args) {
		var plugin = this;
		// in some cases we need to refresh isotope layout immediately
		if (!plugin.get(&quot;rendered&quot;)) return;
		setTimeout(function() {
			publish.call(plugin, true);
		}, 0);
	};
});

// TODO: avoid coherence between plugin components
plugin.events[&quot;Echo.StreamServer.Controls.Stream.Item.onRender&quot;] = function(topic, args) {
	var plugin = this, item = this.component;
	var body = $(&quot;.echo-streamserver-controls-stream-body&quot;, item.config.get(&quot;parent.target&quot;));
	if (!body.data(&quot;isotope&quot;)) {
		plugin.set(&quot;rendered&quot;, true);
		return;
	}
	if (item.isRoot()) {
		if (!plugin.get(&quot;rendered&quot;) &amp;&amp; !item.config.get(&quot;live&quot;)) {
			body.isotope(&quot;insert&quot;, item.config.get(&quot;target&quot;));
		} else {
			publish.call(this, true);
		}
		plugin.set(&quot;rendered&quot;, true);
	} else {
		publish.call(this, true);
	}
};

})();

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-body'>/**
</span> * @echo_renderer
 */
plugin.component.renderers.body = function(element) {
	var plugin = this, item = this.component;
	element = item.parentRenderer(&quot;body&quot;, arguments);
	var filteredElements = plugin.config.get(&quot;mediaSelector&quot;)(item.get(&quot;data.object.content&quot;));
	$(filteredElements.selector, item.view.get(&quot;text&quot;)).remove();
	var text = Echo.Utils.stripTags(item.get(&quot;data.object.content&quot;));
	item.view.get(&quot;container&quot;).addClass(plugin._getCSSByLength(text.length));
	return element;
};

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-childBody'>/**
</span> * @echo_renderer
 */
plugin.renderers.childBody = function(element) {
	var plugin = this, item = this.component;
	if (item.isRoot()) {
		return element.empty();
	}
	var text = Echo.Utils.htmlTextTruncate(
		Echo.Utils.stripTags(item.get(&quot;data.object.content&quot;)),
		plugin.config.get(&quot;maxChildrenBodyCharacters&quot;),
		&quot;...&quot;
	);
	return element.empty().append(text);
};

<span id='Echo-StreamServer-Controls-Stream-Item-Plugins-PinboardVisualization-echo_renderer-media'>/**
</span> * @echo_renderer
 */
plugin.renderers.media = function(element) {
	var plugin = this, item = this.component;
	var mediaItems = plugin.config.get(&quot;mediaSelector&quot;)(item.get(&quot;data.object.content&quot;));
	if (mediaItems.length) {
		var config = $.extend(plugin.config.get(&quot;gallery&quot;), {
			&quot;target&quot;: element,
			&quot;appkey&quot;: item.config.get(&quot;appkey&quot;),
			&quot;elements&quot;: mediaItems,
			&quot;item&quot;: item
		});
		new Echo.StreamServer.Controls.Stream.Item.MediaGallery(config);
	} else {
		element.hide();
	}
	return element;
};

plugin.methods._getCSSByLength = function(length) {
	var plugin = this, item = this.component;
	var handler = function(range, acc, className) {
		if (length &gt;= range[0] &amp;&amp; length &lt; range[1]) {
			return (acc = className);
		}
	};
	return Echo.Utils.foldl(&quot;&quot;, plugin.config.get(&quot;itemCSSClassByContentLength&quot;), handler);
};

plugin.template =
	'&lt;div class=&quot;{class:container}&quot;&gt;' +
		'&lt;div class=&quot;{class:header}&quot;&gt;' +
			'&lt;div class=&quot;{class:avatar-wrapper}&quot;&gt;' +
				'&lt;div class=&quot;{class:avatar}&quot;&gt;&lt;/div&gt;' +
			'&lt;/div&gt;' +
			'&lt;div class=&quot;{plugin.class:topContentWrapper}&quot;&gt;' +
				'&lt;div class=&quot;{class:authorName} echo-linkColor&quot;&gt;&lt;/div&gt;' +
				'&lt;div class=&quot;{plugin.class:childBody}&quot;&gt;&lt;/div&gt;' +
				'&lt;div class=&quot;echo-clear&quot;&gt;&lt;/div&gt;' +
			'&lt;/div&gt;' +
			'&lt;div class=&quot;echo-clear&quot;&gt;&lt;/div&gt;' +
		'&lt;/div&gt;' +
		'&lt;input type=&quot;hidden&quot; class=&quot;{class:modeSwitch}&quot;&gt;' +
		'&lt;div class=&quot;echo-clear&quot;&gt;&lt;/div&gt;' +
		'&lt;div class=&quot;{class:wrapper}&quot;&gt;' +
			'&lt;div class=&quot;{class:subcontainer}&quot;&gt;' +
				'&lt;div class=&quot;{class:data}&quot;&gt;' +
					'&lt;div class=&quot;{plugin.class:media}&quot;&gt;&lt;/div&gt;' + 
					'&lt;div class=&quot;{class:body} echo-primaryColor&quot;&gt; ' + 
						'&lt;span class=&quot;{class:text}&quot;&gt;&lt;/span&gt;' +
						'&lt;span class=&quot;{class:textEllipses}&quot;&gt;...&lt;/span&gt;' +
						'&lt;span class=&quot;{class:textToggleTruncated} echo-linkColor echo-clickable&quot;&gt;&lt;/span&gt;' +
					'&lt;/div&gt;' +
				'&lt;/div&gt;' +
				'&lt;div class=&quot;{class:footer} echo-secondaryColor echo-secondaryFont&quot;&gt;' +
					'&lt;img class=&quot;{class:sourceIcon} echo-clickable&quot;&gt;' +
					'&lt;div class=&quot;{class:date}&quot;&gt;&lt;/div&gt;' +
					'&lt;div class=&quot;{class:from}&quot;&gt;&lt;/div&gt;' +
					'&lt;div class=&quot;{class:via}&quot;&gt;&lt;/div&gt;' +
					'&lt;div class=&quot;{class:buttons}&quot;&gt;&lt;/div&gt;' +
					'&lt;div class=&quot;echo-clear&quot;&gt;&lt;/div&gt;' +
				'&lt;/div&gt;' +
			'&lt;/div&gt;' +
		'&lt;/div&gt;' +
	'&lt;/div&gt;';

plugin.css =
	'.{plugin.class:media} { margin-top: 7px; text-align: center; }' +
	'.{plugin.class:topContentWrapper} { margin-left: 5px; padding-left: 35px; }' +
	'.{plugin.class:childBody} { float: none; display: inline; margin-left: 5px; }' +
	'.{plugin.class:childBody} a { text-decoration: none; font-weight: bold; color: #524D4D; }' +
	'.{plugin.class} .{class:container} { padding: 0px; }' +
	'.{plugin.class} .{class:content} { padding-bottom: 0px; background: white; box-shadow: 1px 1px 2px rgba(34, 25, 25, 0.4); margin: 0px 5px 15px 5px; border: 1px solid #D9D4D4; border-bottom: none; border-right: none; }' +
	'.{plugin.class} .{class:authorName} { float: none; display: inline; margin-left: 0px; }' +
	'.{plugin.class} .{class:body} { margin: 0px; }' +
	'.{plugin.class} .{class:avatar} { float: left; width: 30px; height: 30px; padding-right: 10px; }' +
	'.{plugin.class} .{class:depth-1} { margin-left: 0px; border-bottom: none; }' +
	'.{plugin.class} .{class:depth-1} .{class:authorName} { display: inline; font-size: 12px; }' +
	'.{plugin.class} .{class:depth-0} { padding: 15px 15px 10px 15px; }' +
	'.{plugin.class} .{class:depth-0} .{class:authorName} { font-size: 15px; margin-top: 4px; }' +
	'.{plugin.class} .{class:wrapper} { float: none; }' +
	'.{plugin.class} .{class:subcontainer} { float: none; }' +
	'.{plugin.class} .{class:date} { color: #C6C6C6; text-decoration: none; font-weight: normal; }' +
	'.{plugin.class} .{class:footer} a { color: #C6C6C6; text-decoration: none; font-weight: normal; }' +
	'.{plugin.class} .{class:footer} a:hover { text-decoration: underline; }' +
	'.{plugin.class} .{class:container} .{class:footer} { margin-top: 5px; }' +
	'.{plugin.class} .{class:children} .{class:header} { margin-left: 0px; }' +
	'.{plugin.class} .{class:smallSizeContent} .{class:body} { font-size: 18px; line-height: 25px; }' +
	'.{plugin.class} .{class:mediumSizeContent} .{class:body} { font-size: 16px; line-height: 22px; }' +
	'.{plugin.class} .{class:children} .{class:container} { background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:childrenByCurrentActorLive} .{class:container} { background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:children} .{class:wrapper}  { display: none; }' +
	'.{plugin.class} .{class:childrenByCurrentActorLive} .{class:wrapper} {display: none}' +
	'.{plugin.class} .{class:children} .{class:content} { box-shadow: none; margin: 0px; padding: 0px; border: none; border-bottom: 1px solid #d9d4d4; background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:childrenByCurrentActorLive} .{class:content} { box-shadow: none; margin: 0px; padding: 0px; border: none; border-bottom: 1px solid #d9d4d4; background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:container-child} { margin: 0px; padding: 10px 15px; }' +
	'.{plugin.class} .echo-linkColor { text-decoration: none; font-weight: bold; color: #524D4D; }' +
	'.{plugin.class} .echo-linkColor a { text-decoration: none; font-weight: bold; color: #524D4D; }' +
	'.{plugin.class} .{class:buttons} .echo-linkColor { font-weight: normal; color: #C6C6C6; }' +
	'.{plugin.class} .{class:buttons} .echo-linkColor:hover { font-weight: normal; color: #C6C6C6; }' +
	'.{plugin.class} .{class:expandChildren} .echo-message-icon { background-image: none; }' +
	'.{plugin.class} .{class:expandChildren} { border-bottom: 1px solid #D9D4D4; background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:expandChildren} .{class:message-loading} { background-image: none; font-weight: bold; }' +
	'.{plugin.class} .{class:expandChildren} .{class:expandChildrenLabel} { padding-left: 0px; background-image: none; }' +
	// plugins styles
	'.{plugin.class} .{class:plugin-Like-likedBy} { margin-top: 5px; }' +
	'.{plugin.class} .{class:plugin-Reply-submitForm} { box-shadow: none; margin: 0px; border: none; background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:plugin-Reply-compactForm} { box-shadow: none; margin: 0px; border: none; background-color: #F2F0F0; }' +
	'.{plugin.class} .{class:plugin-Reply-replyForm} .echo-identityserver-controls-auth-name { font-size: 12px; }' +
	'.{plugin.class} .{class:plugin-Reply-replyForm} .echo-identityserver-controls-auth-logout { line-height: 24px; }' +
	'.{plugin.class} .{class:plugin-Reply-replyForm} .echo-streamserver-controls-submit-userInfoWrapper {  margin: 5px 0px; }' +
	'.{plugin.class} .{class:plugin-Reply-replyForm} .echo-streamserver-controls-submit-plugin-FormAuth-forcedLoginMessage { font-size: 13px; }' +
	'.{plugin.class} .{class:plugin-Moderation-status}  { width: 30px; clear: both; }' +
	'.{plugin.class} .{class:plugin-TweetDisplay-tweetUserName}, .{plugin.class} .{class:authorName} { float: none; word-wrap: normal; display: block; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }' +
	'.{plugin.class} .{class:plugin-TweetDisplay-tweetUserName} { margin-left: 0px; }' +
	'.{class:plugin-TweetDisplay} .{plugin.class:childBody} { margin-left: 0; }' +

	// TODO: Remove this block after TwitterIntents removing
	'.{plugin.class} .{class:plugin-TwitterIntents-tweetUserName}, .{plugin.class} .{class:authorName} { float: none; word-wrap: normal; display: block; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }' +
	'.{plugin.class} .{class:plugin-TwitterIntents-tweetUserName} { margin-left: 0px; }' +
	'.{class:plugin-TwitterIntents} .{plugin.class:childBody} { margin-left: 0; }' +

	((typeof document.createElement(&quot;div&quot;).style.boxShadow === &quot;undefined&quot;)
		? '.{plugin.class} .{class:content} { border: 1px solid #d9d4d4; box-shadow: none; }'
		: '');
	
Echo.Plugin.create(plugin);

})(Echo.jQuery);

(function(jQuery) {
&quot;use strict&quot;;

var $ = jQuery;

<span id='Echo-StreamServer-Controls-Stream-Plugins-PinboardVisualization'>/**
</span> * @class Echo.StreamServer.Controls.Stream.Plugins.PinboardVisualization
 * The PinboardVisualization plugin transforms Echo Stream Client visualization
 * into a pinboard-style representation. The plugin extracts all media (such as
 * images, videos, etc) from the item content and assembles the mini media
 * gallery inside the item UI. You can find UI example of the plugin
 * &lt;a href=&quot;http://echosandbox.com/use-cases/pinboard-visualization/&quot;&gt;here&lt;/a&gt;.
 *
 * __Note__: the &quot;PinboardVisualization&quot; plugin is not included into the
 * StreamServer JS package (streamserver.pack.js). Please include the
 * scripts below (production and development versions respectively) to
 * load the &quot;PinboardVisualization&quot; plugin:
 *
 * http://cdn.echoenabled.com/sdk/v3/streamserver/plugins/pinboard-visualization.js  
 * http://cdn.echoenabled.com/sdk/v3/dev/streamserver/plugins/pinboard-visualization.js
 *
 * 	new Echo.StreamServer.Controls.Stream({
 * 		&quot;target&quot;: document.getElementById(&quot;echo-stream&quot;),
 * 		&quot;appkey&quot;: &quot;echo.jssdk.demo.aboutecho.com&quot;,
 * 		&quot;plugins&quot;: [{
 * 			&quot;name&quot;: &quot;PinboardVisualization&quot;
 * 		}]
 * 	});
 *
 * More information regarding the plugins installation can be found
 * in the [“How to initialize Echo components”](#!/guide/how_to_initialize_components-section-2) guide.
 *
 * @extends Echo.Plugin
 *
 * @package streamserver/plugins/pinboard-visualization.js
 */
var plugin = Echo.Plugin.manifest(&quot;PinboardVisualization&quot;, &quot;Echo.StreamServer.Controls.Stream&quot;);

if (Echo.Plugin.isDefined(plugin)) return;

var ua = navigator.userAgent.toLowerCase();
var isMozillaBrowser = !!(
		!~ua.indexOf(&quot;chrome&quot;)
		&amp;&amp; !~ua.indexOf(&quot;webkit&quot;)
		&amp;&amp; !~ua.indexOf(&quot;opera&quot;)
		&amp;&amp; (
			/(msie) ([\w.]+)/.exec(ua)
			|| ua.indexOf(&quot;compatible&quot;) &lt; 0 &amp;&amp; /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)
		)
	);

plugin.config = {
<span id='Echo-StreamServer-Controls-Stream-Plugins-PinboardVisualization-cfg-isotope'>	/**
</span>	 * @cfg {Object} isotope
	 * Allows to configure the Isotope jQuery plugin, used by the plugin as the
	 * rendering engine. The possible config values can be found at the Isotope
	 * plugin homepage ([http://isotope.metafizzy.co/](http://isotope.metafizzy.co/)). It's NOT recommended to
	 * change the settings of the Isotope unless it's really required.
	 *
	 *__Note__: the Isotope JS library doesn't work in IE &lt;a href=&quot;http://en.wikipedia.org/wiki/Quirks_mode&quot;&gt;quirks mode&lt;/a&gt;.
	 * Due to this fact you should declare the necessary &lt;a href=&quot;http://en.wikipedia.org/wiki/DOCTYPE&quot;&gt;\&lt;DOCTYPE\&gt;&lt;/a&gt;
	 * on the page. We recommend to use a
	 * &lt;a href=&quot;http://en.wikipedia.org/wiki/DOCTYPE#HTML5_DTD-less_DOCTYPE&quot;&gt;HTML5 DOCTYPE&lt;/a&gt; declaration.
	 */
	&quot;isotope&quot;: {
		&quot;animationOptions&quot;: {
			// change duration for mozilla browsers
			&quot;duration&quot;: isMozillaBrowser ? 0 : 2750,
			&quot;easing&quot;: &quot;linear&quot;,
			&quot;queue&quot;: false
		},
		// use only jQuery engine for animation in mozilla browsers
		// due to the issues with video display with CSS transitions
		&quot;animationEngine&quot;: isMozillaBrowser ? &quot;jquery&quot; : &quot;best-available&quot;
	}
};

plugin.enabled = function() {
	return document.compatMode !== &quot;BackCompat&quot;
};

plugin.dependencies = [{
	&quot;loaded&quot;: function() { return !!Echo.jQuery().isotope; },
	&quot;url&quot;: &quot;{config:cdnBaseURL.sdk}/third-party/jquery/jquery.isotope.min.js&quot;
}];

plugin.events = {
	&quot;Echo.StreamServer.Controls.Stream.onRender&quot;: function(topic, args) {
		this._refreshView();
	},
	&quot;Echo.StreamServer.Controls.Stream.onRefresh&quot;: function(topic, args) {
		this._refreshView();
	},
	&quot;Echo.StreamServer.Controls.Stream.Item.Plugins.PinboardVisualization.onChangeView&quot;: function(topic, args) {
		var plugin = this;
		if (args.force) {
			plugin._refreshView();
		} else {
			plugin.component.queueActivity({
				&quot;action&quot;: &quot;rerender&quot;,
				&quot;item&quot;: plugin.component.items[args.item.data.unique],
				&quot;priority&quot;: &quot;high&quot;,
				&quot;handler&quot;: function() {
					plugin._refreshView();
					plugin.component._executeNextActivity();
				}
			});
		}
	}
};

plugin.methods._refreshView = function() {
	var plugin = this, stream = this.component;
	var body = stream.view.get(&quot;body&quot;);
	var hasEntries = stream.threads.length;
	body.data(&quot;isotope&quot;)
		? (hasEntries
			? body.isotope(&quot;reloadItems&quot;).isotope({&quot;sortBy&quot;: &quot;original-order&quot;})
			: body.isotope(&quot;destroy&quot;))
		: hasEntries &amp;&amp; body.isotope(
			plugin.config.get(&quot;isotope&quot;)
		);
};

plugin.css = 
	'.{plugin.class} .isotope { -webkit-transition-property: height, width; -moz-transition-property: height, width; -o-transition-property: height, width; transition-property: height, width;  -webkit-transition-duration: 0.8s; -moz-transition-duration: 0.8s; -o-transition-duration: 0.8s; transition-duration: 0.8s; }' +
	'.{plugin.class} .isotope .isotope-item { -webkit-transition-property: -webkit-transform, opacity; -moz-transition-property: -moz-transform, opacity; -o-transition-property: top, left, opacity; transition-property:transform, opacity; -webkit-transition-duration: 0.8s; -moz-transition-duration: 0.8s; -o-transition-duration: 0.8s; transition-duration: 0.8s; }';

Echo.Plugin.create(plugin);

})(Echo.jQuery);
</pre>
</body>
</html>
