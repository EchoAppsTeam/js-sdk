<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">(function(jQuery) {
&quot;use strict&quot;;

var $ = jQuery;

if (!window.Echo) window.Echo = {};

if (!Echo.GUI) Echo.GUI = {};

if (Echo.GUI.Modal) return;

<span id='Echo-GUI-Modal-method-constructor'><span id='Echo-GUI-Modal-cfg-fade'><span id='Echo-GUI-Modal-cfg-header'><span id='Echo-GUI-Modal-cfg-footer'><span id='Echo-GUI-Modal-cfg-padding'><span id='Echo-GUI-Modal-cfg-height'><span id='Echo-GUI-Modal-cfg-width'><span id='Echo-GUI-Modal-cfg-data'><span id='Echo-GUI-Modal-cfg-onHide'><span id='Echo-GUI-Modal-cfg-onShow'><span id='Echo-GUI-Modal-cfg-href'><span id='Echo-GUI-Modal-cfg-extraClass'><span id='Echo-GUI-Modal-cfg-remote'><span id='Echo-GUI-Modal-cfg-closeButton'><span id='Echo-GUI-Modal-cfg-keyboard'><span id='Echo-GUI-Modal-cfg-backdrop'><span id='Echo-GUI-Modal-cfg-show'><span id='Echo-GUI-Modal'>/**
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> * @class Echo.GUI.Modal
 * Class wrapper for &lt;a href=&quot;http://twitter.github.com/bootstrap/javascript.html#modals&quot; target=&quot;_blank&quot;&gt;bootstrap-modal.js&lt;/a&gt;.
 * The Echo.GUI.Modal class provides a simplified interface to work with the
 * Bootstrap Modal JS class.
 * Echo wrapper assembles the HTML code required for Bootstrap Modal JS class
 * based on the parameters specified in the config and initializes
 * the corresponding Bootstrap JS class.
 *
 * Example:
 *
 * 	var myModal = new Echo.GUI.Modal({
 * 		&quot;show&quot;: true,
 * 		&quot;backdrop&quot;: true,
 * 		&quot;keyboard&quot;: true,
 * 		&quot;closeButton&quot;: true,
 * 		&quot;remote&quot;: false,
 * 		&quot;extraClass&quot;: &quot;&quot;,
 * 		&quot;data&quot;: {
 * 			&quot;title&quot;: &quot;Modal title&quot;,
 * 			&quot;body&quot;: &quot;&lt;b&gt;Modal body&lt;/b&gt;&quot;,
 * 			&quot;buttons&quot;: [{
 * 				&quot;title&quot;: &quot;Button1&quot;,
 * 				&quot;extraClass&quot;: &quot;echo-button1-class&quot;,
 * 				&quot;handler&quot;: function() {}
 * 			}, {
 * 				&quot;title&quot;: &quot;Button2&quot;,
 * 				&quot;extraClass&quot;: &quot;echo-button2-class&quot;,
 * 				&quot;handler&quot;: function() {}
 * 			}]
 * 		},
 * 		&quot;width&quot;: &quot;400&quot;,
 * 		&quot;height&quot;: &quot;500&quot;,
 * 		&quot;padding&quot;: &quot;10&quot;,
 * 		&quot;footer&quot;: true,
 * 		&quot;header&quot;: true,
 * 		&quot;fade&quot;: true
 * 	});
 *
 * 	myModal.hide(); // hides the Bootstrap Modal instance
 * 	myModal.config.set(&quot;data.title&quot;, &quot;New modal title&quot;); // change title of the Bootstrap Modal instance
 * 	myModal.config.set(&quot;closeButton&quot;, false); // do not show the close button
 * 	myModal.refresh(); // refresh the Bootstrap Modal instance with changed config parameters and show one
 *
 * @extends Echo.GUI
 *
 * @package gui.pack.js
 *
 * @constructor
 * Creates a new modal dialog. The dialog can be created in visible or hidden (default) modes.
 * In order to initialize the modal dialog instance in visible state, the &quot;show&quot; parameter should
 * be defined as &#39;true&#39; (JS boolean) during the constructor call.
 * For the modal dialogs hidden by default the &quot;show&quot; function can be applied to reveal it when appropriate.
 *
 * @param {Object} config
 * Modal configuration.
 *
 * @cfg {Boolean} [show=false]
 * Defines whether the modal dialog should be displayed right after it is created. 
 *
 * @cfg {Boolean} [backdrop=true]
 * Defines whether the semi-transparent backdrop underneath the modal dialog box should be displayed.
 *
 * @cfg {Boolean} [keyboard=true]
 * Defines whether modal dialog should be closed if the &quot;Esc&quot;(escape) key is pressed on the keyboard.
 *
 * @cfg {Boolean} [closeButton=true]
 * Defines whether the close (&quot;X&quot;) icon in the top right corner of the dialog box should be shown.
 *
 * @cfg {String} [remote=false]
 * Remote URL.
 * If a remote URL is provided, content will be loaded via jQuery load method and injected into the modal dialog body.
 *
 * @cfg {String} [extraClass=&quot;&quot;]
 * Custom class name which should be added to the modal dialog container.
 *
 * @cfg {String} [href]
 * URL of the standalone page to be displayed inside the modal (loaded via &amp;lt;iframe&gt;).
 *
 * @cfg {Function} [onShow]
 * Callback function to be executed when the modal is opened.
 *
 * @cfg {Function} [onHide]
 * Callback function to be executed when the modal is closed.
 *
 * @cfg {Object} data
 *
 * @cfg {String|Function} data.title
 * Modal dialog title (can contain HTML tags).
 * If function passed in this parameter, the function result will be used.
 *
 * @cfg {String|Function} data.body
 * The main content of the dialog (can contain HTML tags).
 * If function passed in this parameter, the function result will be used.
 *
 * @cfg {Array} data.buttons
 * You can specify the custom buttons in this parameter which should be displayed in the modal footer.
 * Each array element is the object with the following parameters:
 *
 * + title - button title.
 * + extraClass - custom class name which will be added to the button.
 * + handler - function which will be called when button is clicked.
 *
 * @cfg {Number} [width=null]
 * Modal dialog width.
 *
 * @cfg {Number} [height=null]
 * Modal dialog height.
 *
 * @cfg {Number} [padding=null]
 * Modal dialog padding.
 *
 * @cfg {Boolean} [footer=true]
 * Display modal dialog footer.
 * Should be true if you want to display custom buttons.
 *
 * @cfg {Boolean} [header=true]
 * Display modal header.
 *
 * @cfg {Boolean} [fade=false]
 * Apply a CSS fade transition.
 */
Echo.GUI.Modal = Echo.Utils.inherit(Echo.GUI, function(config) {
	Echo.GUI.call(this, config, {
		&quot;targetless&quot;: true,
		&quot;show&quot;: false,
		&quot;backdrop&quot;: true,
		&quot;keyboard&quot;: true,
		&quot;closeButton&quot;: true,
		&quot;remote&quot;: false,
		&quot;extraClass&quot;: &quot;&quot;,
		&quot;data&quot;: {},
		&quot;width&quot;: null,
		&quot;height&quot;: null,
		&quot;padding&quot;: null,
		&quot;footer&quot;: true,
		&quot;header&quot;: true,
		&quot;onHide&quot;: function() {},
		&quot;onShow&quot;: function() {},
		&quot;fade&quot;: false
	});
});

<span id='Echo-GUI-Modal-method-refresh'>/**
</span> * This method assemble a bootstrap dialog according to configuration
 * parameters and data.
 */
Echo.GUI.Modal.prototype.refresh = function() {
	var self = this;
	if (this.rendered) this.destroy();

	this.rendered = true;
	var css = this.config.get(&quot;fade&quot;) ? &quot;fade&quot; : &quot;hide&quot;;
	this.element = $(&#39;&lt;div class=&quot;modal &#39; + css + &#39;&quot; role=&quot;dialog&quot; tabindex=&quot;-1&quot;&gt;&#39;);

	this._assembleHeader();
	this._assembleBody();
	this._assembleFooter();
	this._assembleBackdrop();

	this.element.on(&quot;hidden&quot;, function() {
		self.destroy();
	});
	this.element.on(&quot;shown&quot;, function() {
		self.config.get(&quot;onShow&quot;).call(self, self.element);
	});

	this.element.appendTo(&quot;body&quot;)
		.wrap(&#39;&lt;div class=&quot;echo-sdk-ui&quot;&gt;&#39;)
		.modal(this.config.getAsHash());

	// if we try show few modals in one time, then event &quot;focusin.modal&quot; be called infinity times
	$(document).off(&quot;focusin.modal&quot;);
};

<span id='Echo-GUI-Modal-method-show'>/**
</span> * Shows the modal dialog.
 */
Echo.GUI.Modal.prototype.show = function() {
	this.rendered
		? this.element.modal(&quot;show&quot;)
		: this.refresh();
};

<span id='Echo-GUI-Modal-method-destroy'>/**
</span> * Hides the modal dialog and removes the dialog instance.
 */
Echo.GUI.Modal.prototype.destroy = function() {
	if (this.rendered) {
		this.element.modal(&quot;hide&quot;);
		this.rendered = false;
		this.backdrop &amp;&amp; this.backdrop.remove();
		this.element.find(&quot;iframe&quot;).hide().attr(&quot;src&quot;, &quot;//about:blank&quot;).end().empty();
		this.element.unwrap().remove();
		this.config.get(&quot;onHide&quot;).call(this, this.element);
	}
};

<span id='Echo-GUI-Modal-method-hide'>/**
</span> * Hides the modal dialog.
 */
Echo.GUI.Modal.prototype.hide = function() {
	if (this.rendered) {
		this.element.modal(&quot;hide&quot;);
	}
};

Echo.GUI.Modal.prototype._assembleHeader = function() {
	if (this.config.get(&quot;header&quot;)) {
		var header = this._addSection(&quot;modal-header&quot;, $(&quot;&lt;h3&gt;&quot;).append(this.config.get(&quot;data&quot;).title));
		if (this.config.get(&quot;closeButton&quot;)) {
			$(&#39;&lt;button aria-hidden=&quot;true&quot; data-dismiss=&quot;modal&quot; class=&quot;close&quot; type=&quot;button&quot;&gt;&#39;)
				.append(&quot;&amp;times;&quot;).prependTo(header);
		}
	}
};

Echo.GUI.Modal.prototype._assembleBody = function() {
	var self = this;
	var body = this._addSection(&quot;modal-body&quot;, this.config.get(&quot;data&quot;).body);
	if (this.config.get(&quot;href&quot;)) {
		this.element.one(&quot;shown&quot;, function() {
			var iframe = $(&#39;&lt;iframe src=&quot;&#39; + self.config.get(&quot;href&quot;) + &#39;&quot; id=&quot;&quot; name=&quot;&quot; class=&quot;echo-modal-iframe&quot; frameborder=&quot;0&quot; vspace=&quot;0&quot; hspace=&quot;0&quot; webkitAllowFullScreen mozallowfullscreen allowFullScreen&gt;&lt;/iframe&gt;&#39;);
			if (typeof iframe.get(0).allowTransparency !== &quot;undefined&quot;) {
				iframe.attr(&quot;allowTransparency&quot;, &quot;true&quot;);
			}
			body.append(iframe);
		});
	}
	if (this.config.get(&quot;width&quot;) !== null) {
		this.element.width(this.config.get(&quot;width&quot;))
			.css({&quot;margin-left&quot;: this.config.get(&quot;width&quot;) * -0.5});
	}
	if (this.config.get(&quot;height&quot;) !== null) {
		body.height(this.config.get(&quot;height&quot;));
	}
	if (this.config.get(&quot;padding&quot;) !== null) {
		body.css(&quot;padding&quot;, this.config.get(&quot;padding&quot;));
	}
	if (this.config.get(&quot;extraClass&quot;)) {
		this.element.addClass(this.config.get(&quot;extraClass&quot;));
	}
};

Echo.GUI.Modal.prototype._assembleFooter = function() {
	var self = this;
	if (this.config.get(&quot;footer&quot;)) {
		var footer = this._addSection(&quot;modal-footer&quot;);
		if (this.config.get(&quot;data&quot;).buttons) {
			$.map(this.config.get(&quot;data&quot;).buttons, function(button) {
				var el = $(&quot;&lt;button&gt;&quot;).addClass(&quot;btn&quot;).append(button.title);
				if (button.extraClass) {
					el.addClass(button.extraClass);
				}
				el.click(function() {
					button.handler &amp;&amp; button.handler.call(self, this);
				});
				el.appendTo(footer);
			});
		}
	}
};

Echo.GUI.Modal.prototype._assembleBackdrop = function() {
	var self = this;
	if (self.config.get(&quot;backdrop&quot;)) {
		if (self.config.get(&quot;fade&quot;)) {
			self.element.on(&quot;show&quot;, function() {
				var modal = self.element.data(&quot;modal&quot;);
				var shown = modal.isShown;
				var backdrop = modal.options.backdrop;

				modal.options.backdrop = true;
				modal.isShown = true;
				modal.backdrop(function(){});
				modal.isShown = shown;
				modal.options.backdrop = backdrop;

				self.backdrop = modal.$backdrop.wrap(&#39;&lt;div class=&quot;echo-sdk-ui&quot;&gt;&#39;).parent();
			});
		} else {
			self.element.on(&quot;shown&quot;, function() {
				self.backdrop = self.element.data(&quot;modal&quot;).$backdrop.wrap(&#39;&lt;div class=&quot;echo-sdk-ui&quot;&gt;&#39;).parent();
			});
		}
		// we used manual control for backdrop if fade is true
		if (self.config.get(&quot;fade&quot;)) {
			self.config.set(&quot;backdrop&quot;, false);
		}
	}
};

Echo.GUI.Modal.prototype._addSection = function(css, content) {
	var section = $(&#39;&lt;div class=&quot;&#39; + css + &#39;&quot;&gt;&#39;);
	this.element.append(section);
	if (content) {
		section.append($.isFunction(content) ? content(section) : content);
	}
	return section;
};

})(Echo.jQuery);
</pre>
</body>
</html>
