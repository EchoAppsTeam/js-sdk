<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">(function(jQuery) {
&quot;use strict&quot;;

var $ = jQuery;

<span id='Echo-StreamServer-Controls-Stream-Plugins-InfiniteScroll'>/**
</span> * @class Echo.StreamServer.Controls.Stream.Plugins.InfiniteScroll
 * Echo Stream plugin automatically loads the next page full of items
 * when the end of the stream is displayed in the browser.
 * This produces the &#39;Infinite Scroll&#39; Effect.
 *
 * 	new Echo.StreamServer.Controls.Stream({
 * 		&quot;target&quot;: document.getElementById(&quot;echo-stream&quot;),
 * 		&quot;appkey&quot;: &quot;echo.jssdk.demo.aboutecho.com&quot;,
 * 		&quot;plugins&quot;: [{
 * 			&quot;name&quot;: &quot;InfiniteScroll&quot;
 * 		}]
 * 	});
 *
 * More information regarding the plugins installation can be found
 * in the [&quot;How to initialize Echo components&quot;](#!/guide/how_to_initialize_components-section-initializing-plugins) guide.
 *
 * @extends Echo.Plugin
 *
 * @package streamserver/plugins.pack.js
 * @package streamserver.pack.js
 */
var plugin = Echo.Plugin.manifest(&quot;InfiniteScroll&quot;, &quot;Echo.StreamServer.Controls.Stream&quot;);

if (Echo.Plugin.isDefined(plugin)) return;

plugin.init = function() {
	var plugin = this;
	var handler = function(event) {
		var element = plugin.component.view.get(&quot;more&quot;);
		if (element &amp;&amp;
			!plugin.get(&quot;renderInProgress&quot;) &amp;&amp;
			!plugin.get(&quot;requestInProgress&quot;) &amp;&amp;
			$.inviewport(element, {&quot;threshold&quot;: 0})
		) {
			element.click();
		}
	};
	plugin.set(&quot;scrollHandler&quot;, handler);
	$(window).on(&quot;scroll&quot;, handler);
};

plugin.events = {
	&quot;Echo.StreamServer.Controls.Stream.onDataReceive&quot;: function() {
		this.set(&quot;requestInProgress&quot;, false);
	},
	&quot;Echo.StreamServer.Controls.Stream.onMoreButtonPress&quot;: function() {
		this.set(&quot;requestInProgress&quot;, true);
		this.set(&quot;renderInProgress&quot;, true);
	}
};

plugin.component.renderers.more = function(element) {
	this.parentRenderer(&quot;more&quot;, arguments);
	this.set(&quot;renderInProgress&quot;, false);
	return element;
};

plugin.methods.destroy = function() {
	$(window).off(&quot;scroll&quot;, this.get(&quot;scrollHandler&quot;));
};

Echo.Plugin.create(plugin);

})(Echo.jQuery);
</pre>
</body>
</html>
